<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Расшифровка VIN</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #fff;
      color: #000;
    }
    .header {
      text-align: center;
      padding: 16px;
      background: #f0f9f0;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    h1 { color: #2b613f; margin: 0; }
    .subtitle { color: #555; margin-top: 8px; }
    .nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 16px 0;
    }
    .nav a {
      text-decoration: none;
      color: #000;
      padding: 4px 12px;
      border: 1px solid #ccc;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    button {
      background: #2b613f;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .info { color: #555; font-size: 0.9rem; }
    .result {
      background: #f8f8f8;
      padding: 12px;
      margin-top: 10px;
      border-left: 3px solid #2b613f;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Расшифровка VIN</h1>
    <p class="subtitle">Введите 17-значный VIN российского автомобиля (LADA, ВАЗ)</p>
  </div>

  <div class="nav">
    <a href="index.html">Главная</a>
    <a href="my-car.html">Моё авто</a>
  </div>

  <input type="text" id="vinInput" placeholder="Например: XTA210990V2162379" maxlength="17" />
  <button onclick="decodeVIN()">Расшифровать VIN</button>

  <p class="info">ℹ️ Поддерживаются только VIN, начинающиеся с XTA (ВАЗ/LADA)</p>

  <div id="message"></div>
  <div id="result"></div>
  <button id="saveBtn" style="display:none;" onclick="saveToMyCar()">✅ Сохранить в «Моё авто»</button>

  <script>
    // Словарь для расшифровки
    const VIN_DECODE_MAP = {
      "XTA210": { brand: "ВАЗ / LADA", model: "2101-2107" },
      "XTA211": { brand: "ВАЗ / LADA", model: "2110-2115" },
      "XTA217": { brand: "ВАЗ / LADA", model: "Priora" },
      "XTA218": { brand: "ВАЗ / LADA", model: "Granta" },
      "XTA219": { brand: "ВАЗ / LADA", model: "Kalina" },
      "XTAB15": { brand: "ВАЗ / LADA", model: "Vesta" },
      "XTAXRAY": { brand: "ВАЗ / LADA", model: "XRAY" }
    };

    const YEAR_CODE = {
      'X': 1999, 'Y': 2000, '1': 2001, '2': 2002, '3': 2003, '4': 2004,
      '5': 2005, '6': 2006, '7': 2007, '8': 2008, '9': 2009,
      'A': 2010, 'B': 2011, 'C': 2012, 'D': 2013, 'E': 2014,
      'F': 2015, 'G': 2016, 'H': 2017, 'J': 2018, 'K': 2019,
      'L': 2020, 'M': 2021, 'N': 2022, 'P': 2023, 'R': 2024, 'S': 2025
    };

    let currentVINData = null;

    function decodeVIN() {
      const input = document.getElementById('vinInput');
      const message = document.getElementById('message');
      const result = document.getElementById('result');
      const saveBtn = document.getElementById('saveBtn');

      message.innerHTML = '';
      result.innerHTML = '';
      saveBtn.style.display = 'none';

      const vin = (input.value || '').trim().toUpperCase();

      if (vin.length !== 17 || !/^[A-HJ-NPR-Z0-9]{17}$/.test(vin)) {
        message.innerHTML = '<span style="color:red;">VIN должен содержать 17 символов (без I, O, Q)</span>';
        return;
      }

      if (!vin.startsWith('XTA')) {
        message.innerHTML = '<span style="color:red;">Поддерживаются только VIN, начинающиеся с XTA (ВАЗ/LADA)</span>';
        return;
      }

      // Определение модели
      const modelKey = vin.substring(0, 5); // XTA21
      const modelInfo = VIN_DECODE_MAP[modelKey] || { brand: "ВАЗ / LADA", model: "неизвестна" };

      // Определение года
      const yearChar = vin[9];
      const year = YEAR_CODE[yearChar] || 'неизвестен';

      currentVINData = {
        vin: vin,
        brand: modelInfo.brand,
        model: modelInfo.model,
        year: year,
        engine: "—",
        body: "—"
      };

      result.innerHTML = `
        <div class="result">
          <strong>${currentVINData.brand} ${currentVINData.model}</strong><br>
          Год: ${currentVINData.year}<br>
          VIN: ${currentVINData.vin}
        </div>
      `;
      message.innerHTML = '<span style="color:green;">✅ VIN успешно расшифрован!</span>';
      saveBtn.style.display = 'inline-block';
    }

    function saveToMyCar() {
      if (currentVINData) {
        localStorage.setItem('myCar', JSON.stringify(currentVINData));
        alert('✅ Автомобиль сохранён в «Моё авто»!');
      }
    }
  </script>
</body>
</html>
