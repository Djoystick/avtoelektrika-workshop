<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ VIN</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .card { background: #f0f8ff; padding: 16px; margin: 12px 0; border-left: 4px solid #007bff; }
    input, button { padding: 10px; margin: 6px; font-size: 16px; }
    .result { margin-top: 20px; }
    .error { color: red; }
    .success { color: green; }
    a.back { display: inline-block; margin-top: 20px; color: #007bff; }
  </style>
</head>
<body>
  <h1>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ VIN</h1>
  <p>–í–≤–µ–¥–∏—Ç–µ 17-–∑–Ω–∞—á–Ω—ã–π VIN-–∫–æ–¥ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è:</p>

  <input type="text" id="vinInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: X7LLRRA1XMD123456" maxlength="17" />
  <button onclick="decodeVIN()">–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>

  <div id="message"></div>
  <div id="result" class="result"></div>

  <button onclick="saveToMyCar()" id="saveBtn" style="display:none;">üì¶ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ ¬´–ú–æ—ë –∞–≤—Ç–æ¬ª</button>

  <a href="index.html" class="back">‚Üê –ù–∞–∑–∞–¥ –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</a>

  <script>
    let currentVINData = null;

    async function decodeVIN() {
      const vin = document.getElementById('vinInput').value.trim().toUpperCase();
      const msg = document.getElementById('message');
      const res = document.getElementById('result');
      const saveBtn = document.getElementById('saveBtn');

      msg.innerHTML = '';
      res.innerHTML = '';
      saveBtn.style.display = 'none';

      if (vin.length !== 17 || !/^[A-HJ-NPR-Z0-9]{17}$/.test(vin)) {
        msg.innerHTML = '<div class="error">VIN –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 17 —Å–∏–º–≤–æ–ª–æ–≤ (–±–µ–∑ I, O, Q)</div>';
        return;
      }

      msg.innerHTML = '–ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É...';
      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π API
        const response = await fetch(`https://auto-api.ru/api/vin/${vin}`);
        const data = await response.json();

        if (data.error || !data.mark || !data.model) {
          throw new Error(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å VIN');
        }

        currentVINData = {
          vin: vin,
          brand: data.mark,
          model: data.model,
          year: data.year || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
          engine: data.engine || '',
          body: data.body || ''
        };

        res.innerHTML = `
          <div class="card">
            <strong>${currentVINData.brand} ${currentVINData.model}</strong><br>
            –ì–æ–¥: ${currentVINData.year}<br>
            –î–≤–∏–≥–∞—Ç–µ–ª—å: ${currentVINData.engine || '‚Äî'}<br>
            –ö—É–∑–æ–≤: ${currentVINData.body || '‚Äî'}<br>
            VIN: ${currentVINData.vin}
          </div>
        `;
        saveBtn.style.display = 'inline-block';
        msg.innerHTML = '<div class="success">VIN —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!</div>';
      } catch (err) {
        console.error(err);
        msg.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${err.message || '—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}</div>`;
      }
    }

    function saveToMyCar() {
      if (!currentVINData) return;
      localStorage.setItem('myCar', JSON.stringify(currentVINData));
      alert('‚úÖ –ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ ¬´–ú–æ—ë –∞–≤—Ç–æ¬ª!');
    }
  </script>
</body>
</html>
